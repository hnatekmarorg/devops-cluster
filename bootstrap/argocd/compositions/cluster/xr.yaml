apiVersion: apiextensions.crossplane.io/v1
kind: Composition
metadata:
  name: xclusters.hnatekmar.xyz
spec:
  compositeTypeRef:
    apiVersion: xclusters.hnatekmar.xyz/v1alpha1
    kind: XCluster
  mode: Pipeline
  pipeline:
    - step: extract-kubeconfig
      functionRef:
        name: function-python
      input:
        apiVersion: fn.crossplane.io/v1alpha1
        kind: Script
        source: |
          from crossplane.function import v1alpha1 as fn
          def compose(request: fn.RunFunctionRequest) -> fn.RunFunctionResponse:
              rsp.desired.resources["bucket"].resource.update({
                  "apiVersion": "s3.aws.upbound.io/v1beta2",
                  "kind": "Bucket",
                  "spec": {
                      "forProvider": {
                          "region": req.observed.composite.resource["spec"]["region"]
                      }
                  },
              })
              rsp.desired.resources["bucket"].ready = True
