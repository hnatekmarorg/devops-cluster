apiVersion: metal.sidero.dev/v1alpha2
kind: ServerClass
metadata:
  name: control-plane
spec:
  selector:
    matchLabels:
      node/type: "controlplane"
---
apiVersion: infrastructure.devops.x-k8s.io/v1alpha3
kind: MetalMachineTemplate
metadata:
  name: main-cp
  namespace: default
spec:
  template:
    spec:
      serverClassRef:
        apiVersion: metal.sidero.dev/v1alpha2
        kind: ServerClass
        name: control-plane
        namespace: default
---
apiVersion: controlplane.devops.x-k8s.io/v1alpha3
kind: TalosControlPlane
metadata:
  name: main-cp
  namespace: default
spec:
  controlPlaneConfig:
    controlplane:
      configPatches:
        - op: replace
          path: cluster/extraManifest
          value:
            - https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
            - https://raw.githubusercontent.com/hnatekmarorg/devops-cluster/refs/heads/main/devops/argocd/init.yaml
        - op: replace
          path: /machine/install/disk
          value: /dev/sda
      generateType: controlplane
      talosVersion: v1.10.2
  infrastructureTemplate:
    apiVersion: infrastructure.devops.x-k8s.io/v1alpha3
    kind: MetalMachineTemplate
    name: main-cp
    namespace: default
  replicas: 1
  version: v1.33.0
